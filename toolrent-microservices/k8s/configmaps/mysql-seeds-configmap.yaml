# ============================================
# CONFIGMAPS PARA SEEDS DE MYSQL
# Estos se montan en /docker-entrypoint-initdb.d/
# y se ejecutan automáticamente al iniciar MySQL
# ============================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-tools-seed
  namespace: toolrent
data:
  init.sql: |
    SET NAMES utf8mb4;
    SET CHARACTER SET utf8mb4;
    SET collation_connection = 'utf8mb4_unicode_ci';

    CREATE TABLE IF NOT EXISTS tools (
        id BIGINT NOT NULL AUTO_INCREMENT,
        name VARCHAR(255) NOT NULL,
        category VARCHAR(255) NOT NULL,
        status VARCHAR(255) NOT NULL,
        replacement_value INT NOT NULL,
        stock INT NOT NULL,
        PRIMARY KEY (id),
        UNIQUE KEY uq_tools_name (name)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

    INSERT INTO tools (id, name, category, status, replacement_value, stock) VALUES
    (1, 'Taladro Percutor Bosch 850W', 'Taladros', 'Disponible', 89990, 5),
    (2, 'Taladro Inalámbrico Dewalt 20V', 'Taladros', 'Disponible', 129990, 3),
    (3, 'Taladro de Columna Industrial', 'Taladros', 'Prestada', 450000, 0),
    (4, 'Sierra Circular Makita 7-1/4"', 'Sierras', 'Disponible', 109990, 4),
    (5, 'Sierra Caladora Bosch 650W', 'Sierras', 'Disponible', 69990, 6),
    (6, 'Sierra de Mesa DeWalt 10"', 'Sierras', 'Prestada', 389990, 0),
    (7, 'Sierra Sable Black+Decker', 'Sierras', 'En Reparación', 79990, 1),
    (8, 'Lijadora Orbital Bosch 250W', 'Lijadoras', 'Disponible', 59990, 8),
    (9, 'Lijadora de Banda Makita', 'Lijadoras', 'Disponible', 149990, 2),
    (10, 'Kit Llaves Combinadas 12 Piezas', 'Herramientas Manuales', 'Disponible', 45990, 10),
    (11, 'Juego Destornilladores Profesional', 'Herramientas Manuales', 'Disponible', 29990, 15),
    (12, 'Escalera Telescópica Aluminio 3.8m', 'Herramientas Manuales', 'Prestada', 129990, 0),
    (13, 'Nivel Láser Autonivelante', 'Equipos de Medición', 'Disponible', 89990, 3),
    (14, 'Huincha Métrica Láser 50m', 'Equipos de Medición', 'Disponible', 39990, 7),
    (15, 'Compresor de Aire 50L 2HP', 'Compresores', 'Disponible', 189990, 2),
    (16, 'Pistola de Pintura HVLP', 'Compresores', 'Disponible', 79990, 4),
    (17, 'Soldadora Inverter 200A', 'Soldadura', 'Disponible', 159990, 2),
    (18, 'Taladro Antiguo (Obsoleto)', 'Taladros', 'Baja', 45000, 0),
    (19, 'Sierra Circular Dañada', 'Sierras', 'Baja', 89990, 0),
    (20, 'Desatornillador cruz', 'Herramientas Manuales', 'Disponible', 5990, 10);
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-clients-seed
  namespace: toolrent
data:
  init.sql: |
    SET NAMES utf8mb4;
    SET CHARACTER SET utf8mb4;
    SET collation_connection = 'utf8mb4_unicode_ci';

    CREATE TABLE IF NOT EXISTS clients (
        id BIGINT NOT NULL AUTO_INCREMENT,
        name VARCHAR(255) NOT NULL,
        rut VARCHAR(255) NOT NULL,
        phone VARCHAR(255),
        email VARCHAR(255),
        state VARCHAR(20) NOT NULL,
        PRIMARY KEY (id),
        UNIQUE KEY uq_clients_rut (rut),
        UNIQUE KEY uq_clients_email (email)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

    INSERT INTO clients (id, name, rut, phone, email, state) VALUES
    (1, 'María González Pérez', '16.789.234-5', '+56987654321', 'maria.gonzalez@email.cl', 'Activo'),
    (2, 'Pedro Martínez López', '18.456.789-2', '+56912345678', 'pedro.martinez@empresa.cl', 'Activo'),
    (3, 'Ana Silva Rojas', '20.123.456-7', '+56945678901', 'ana.silva@constructor.cl', 'Activo'),
    (4, 'Carlos Fernández Muñoz', '19.876.543-K', '+56923456789', 'carlos.fernandez@taller.cl', 'Activo'),
    (5, 'Isabel Torres Vargas', '17.234.567-8', '+56934567890', 'isabel.torres@arquitectura.cl', 'Activo'),
    (6, 'Roberto Sánchez Díaz', '21.345.678-9', '+56956789012', 'roberto.sanchez@construcciones.cl', 'Activo'),
    (7, 'Carmen Ramírez Flores', '15.987.654-3', '+56978901234', 'carmen.ramirez@hogar.cl', 'Activo'),
    (8, 'Diego Morales Castro', '19.234.567-1', '+56967890123', 'diego.morales@email.cl', 'Restringido'),
    (9, 'Francisca Herrera Soto', '18.765.432-6', '+56989012345', 'francisca.herrera@empresa.cl', 'Restringido'),
    (10, 'Daniel Valverde', '12.345.678-9', '+56912341234', 'daniel.valverde@email.cl', 'Activo');
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-config-seed
  namespace: toolrent
data:
  init.sql: |
    SET NAMES utf8mb4;
    SET CHARACTER SET utf8mb4;
    SET collation_connection = 'utf8mb4_unicode_ci';

    CREATE TABLE IF NOT EXISTS system_config (
        id BIGINT NOT NULL AUTO_INCREMENT,
        config_key VARCHAR(100) NOT NULL,
        config_value DOUBLE NOT NULL,
        description VARCHAR(255),
        last_modified DATETIME NOT NULL,
        modified_by VARCHAR(255),
        PRIMARY KEY (id),
        UNIQUE KEY uq_config_key (config_key)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

    INSERT INTO system_config (id, config_key, config_value, description, last_modified, modified_by) VALUES
    (1, 'TARIFA_ARRIENDO_DIARIA', 5000.00, 'Tarifa base de arriendo por día (CLP)', NOW(), 'admin'),
    (2, 'TARIFA_MULTA_DIARIA', 2500.00, 'Multa por día de atraso (CLP)', NOW(), 'admin'),
    (3, 'CARGO_REPARACION', 10000.00, 'Cargo fijo por reparación de herramientas con daños leves', NOW(), 'admin');
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-loans-seed
  namespace: toolrent
data:
  init.sql: |
    SET NAMES utf8mb4;
    SET CHARACTER SET utf8mb4;
    SET collation_connection = 'utf8mb4_unicode_ci';

    CREATE TABLE IF NOT EXISTS loans (
        id BIGINT NOT NULL AUTO_INCREMENT,
        client_id BIGINT NOT NULL,
        tool_id BIGINT NOT NULL,
        client_name VARCHAR(255),
        tool_name VARCHAR(255),
        start_date DATE,
        due_date DATE,
        return_date DATE,
        status VARCHAR(255) NOT NULL,
        fine DOUBLE,
        rental_cost DOUBLE,
        damaged TINYINT(1),
        irreparable TINYINT(1),
        PRIMARY KEY (id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

    INSERT INTO loans (id, client_id, tool_id, client_name, tool_name, start_date, due_date, return_date, status, fine, rental_cost, damaged, irreparable) VALUES
    (1, 1, 3, 'María González Pérez', 'Taladro de Columna Industrial', '2025-11-25', '2025-12-09', NULL, 'ATRASADO', 70000, 70000, FALSE, FALSE),
    (2, 1, 6, 'María González Pérez', 'Sierra de Mesa DeWalt 10"', '2025-11-28', '2025-12-12', NULL, 'ATRASADO', 50000, 70000, FALSE, FALSE),
    (3, 2, 12, 'Pedro Martínez López', 'Escalera Telescópica Aluminio 3.8m', '2025-11-30', '2025-12-14', NULL, 'ATRASADO', 46000, 70000, FALSE, FALSE),
    (4, 8, 1, 'Diego Morales Castro', 'Taladro Percutor Bosch 850W', '2025-10-15', '2025-10-29', NULL, 'ATRASADO', 138000, 70000, FALSE, FALSE),
    (5, 9, 4, 'Francisca Herrera Soto', 'Sierra Circular Makita 7-1/4"', '2025-10-01', '2025-10-15', NULL, 'ATRASADO', 166000, 70000, FALSE, FALSE),
    (6, 3, 8, 'Ana Silva Rojas', 'Lijadora Orbital Bosch 250W', '2025-10-01', '2025-10-15', '2025-10-14', 'CERRADO', 0, 70000, FALSE, FALSE),
    (7, 3, 13, 'Ana Silva Rojas', 'Nivel Láser Autonivelante', '2025-10-20', '2025-11-03', '2025-11-02', 'CERRADO', 0, 70000, FALSE, FALSE),
    (8, 4, 9, 'Carlos Fernández Muñoz', 'Lijadora de Banda Makita', '2025-10-10', '2025-10-24', '2025-10-27', 'CERRADO', 6000, 70000, FALSE, FALSE),
    (9, 5, 5, 'Isabel Torres Vargas', 'Sierra Caladora Bosch 650W', '2025-09-15', '2025-09-29', '2025-09-29', 'CERRADO', 10000, 70000, TRUE, FALSE),
    (10, 6, 2, 'Roberto Sánchez Díaz', 'Taladro Inalámbrico Dewalt 20V', '2025-09-01', '2025-09-15', '2025-09-14', 'CERRADO', 129990, 70000, TRUE, TRUE),
    (11, 7, 14, 'Carmen Ramírez Flores', 'Huincha Métrica Láser 50m', '2025-08-01', '2025-08-15', '2025-08-15', 'CERRADO', 0, 70000, FALSE, FALSE),
    (12, 7, 10, 'Carmen Ramírez Flores', 'Kit Llaves Combinadas 12 Piezas', '2025-08-20', '2025-09-03', '2025-09-02', 'CERRADO', 0, 70000, FALSE, FALSE),
    (13, 7, 11, 'Carmen Ramírez Flores', 'Juego Destornilladores Profesional', '2025-09-10', '2025-09-24', '2025-09-23', 'CERRADO', 0, 70000, FALSE, FALSE);
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-kardex-seed
  namespace: toolrent
data:
  init.sql: |
    SET NAMES utf8mb4;
    SET CHARACTER SET utf8mb4;
    SET collation_connection = 'utf8mb4_unicode_ci';

    CREATE TABLE IF NOT EXISTS kardex (
        id BIGINT NOT NULL AUTO_INCREMENT,
        movement_type VARCHAR(50) NOT NULL,
        tool_id BIGINT NOT NULL,
        tool_name VARCHAR(255),
        quantity INT NOT NULL,
        username VARCHAR(100),
        movement_date DATETIME NOT NULL,
        observations TEXT,
        loan_id BIGINT,
        PRIMARY KEY (id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

    INSERT INTO kardex (id, movement_type, tool_id, tool_name, quantity, username, movement_date, observations, loan_id) VALUES
    (1, 'REGISTRO', 1, 'Taladro Percutor Bosch 850W', 5, 'admin', '2025-01-15 10:00:00', 'Alta inicial de taladros Bosch', NULL),
    (2, 'REGISTRO', 2, 'Taladro Inalámbrico Dewalt 20V', 3, 'admin', '2025-01-15 10:15:00', 'Alta inicial de taladros Dewalt', NULL),
    (3, 'REGISTRO', 3, 'Taladro de Columna Industrial', 1, 'admin', '2025-01-15 10:30:00', 'Alta taladro de columna industrial', NULL),
    (4, 'REGISTRO', 4, 'Sierra Circular Makita 7-1/4"', 4, 'admin', '2025-01-16 09:00:00', 'Alta sierras circulares Makita', NULL),
    (5, 'REGISTRO', 5, 'Sierra Caladora Bosch 650W', 6, 'admin', '2025-01-16 09:30:00', 'Alta sierras caladoras Bosch', NULL),
    (6, 'REGISTRO', 8, 'Lijadora Orbital Bosch 250W', 8, 'admin', '2025-01-20 11:00:00', 'Alta lijadoras orbitales', NULL),
    (7, 'REGISTRO', 13, 'Nivel Láser Autonivelante', 3, 'admin', '2025-01-25 14:00:00', 'Alta niveles láser', NULL),
    (8, 'REGISTRO', 15, 'Compresor de Aire 50L 2HP', 2, 'admin', '2025-02-01 10:00:00', 'Alta compresores de aire', NULL);
